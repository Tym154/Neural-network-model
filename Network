#include <iostream>
#include <vector>
#include <cmath>
#include <fstream>
#include <sstream>
#include <vector>
#include <string>

using namespace std;

vector<vector<vector<double>>> weights = {{{0.3, 0.1, -0.4},{-0.3, 0.1, 0.4}},{{0.6, -0.2},{-0.3, 0.2},{-0.7, 0.4}}}; //Storing the weights
vector<vector<double>> nodeVal = {{0},{0},{0},{0}}; //Storning the node values

//Sizing the layers
void assign(){
    vector<double> layerHid(16, 0), layerOut(10, 0);
    nodeVal[0] = reading_data();
    nodeVal[1] = layerHid;
    nodeVal[2] = layerHid;
    nodeVal[3] = layerOut;
}

//function to read the data from a csv file
vector<double> reading_data(){
    fstream data;
    data.open("data/data.csv");

    if(!data.is_open()){
        cout << "Error \n";
    }

    string line;
    getline(data, line);

    vector<double> rowData(784, 0);
    string temp = "";
    int index = 0;

    for(int i = 0; i < line.length(); i++){
       if(line[i] == ','){
        rowData[index++] = stoi(temp);
        temp = "";
       }
       else{
        temp += line[i];
       }
    }

    return rowData;
}

//Activation function
double activation(double x){
    //using sigmoid
    return 1 / (1 + exp(-x));
}

//Forward propagation function
void forward_prop(vector<vector<vector<double>>> weights, vector<vector<double>>& nodeVal){
    for(int i = 0; i < weights.size(); i++){
        vector<double> temp(nodeVal[i+1].size(), 0.0);

        for(int j = 0; j < weights[i].size(); j++){
            for(int k = 0; k < weights[i][j].size(); k++){
                temp[k] += weights[i][j][k] * nodeVal[i][j];
            }
        }

        for(int k = 0; k < temp.size(); k++){
            temp[k] = activation(temp[k]);
        }

        nodeVal[i+1] = temp;
    }
}

//Just testing out the functions for now
int main(){
    forward_prop(weights, nodeVal);

    cout << nodeVal[2][0] << "\n";
    cout << nodeVal[2][1] << "\n";

    return 0;
}

